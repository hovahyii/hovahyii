<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git & GitHub: Interactive Workshop v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Fira+Code:wght@400;600&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        code, .cmd-font { font-family: 'Fira Code', monospace; }
        
        .stage-box { transition: all 0.3s ease; }
        .file-token { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .slide-enter { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 50vh;
        }
    </style>
    <!-- Chosen Palette: "Tech Clarity" - Slate/White for structure, Indigo/Blue for Main Branch, Purple for Feature Branch, Emerald for Success. -->
    
    <!-- Application Structure Plan:
         1. Intro: Expanded "Why" section with "The Old Way vs Git Way" comparison.
         2. Workflow: 3-stage simulator (unchanged, worked well).
         3. Branching: COMPLETELY REBUILT. Now uses 3 datasets in Chart.js (Main, Feature, Connector lines) to accurately draw a tree structure instead of a single line. Added "Active Branch" UI state.
         4. Remote: Diagram unchanged.
         5. Cheatsheet: Unchanged.
    -->

    <!-- Visualization & Content Choices:
         1. "Why Use It": Added a visual "File Chaos" vs "Git Order" text block.
         2. Branching Chart: Switched to Scatter plot with manual dataset management. 
            - Dataset 0: Main branch dots (y=0).
            - Dataset 1: Feature branch dots (y=1).
            - Dataset 2: Lines connecting them. 
            - This prevents the "zig-zag" bug when switching branches.
    -->
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Top Navigation -->
    <nav class="bg-slate-900 text-white shadow-lg z-10 shrink-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <span class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-500">GitFlow</span>
                    <span class="text-xs text-slate-400 px-2 py-1 border border-slate-700 rounded-full">v2.0 Workshop</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4" id="nav-container">
                        <!-- Nav injected by JS -->
                    </div>
                </div>
                <!-- Mobile menu button -->
                <div class="-mr-2 flex md:hidden">
                    <button id="mobile-menu-btn" class="inline-flex items-center justify-center p-2 rounded-md text-slate-400 hover:text-white hover:bg-slate-700 focus:outline-none">
                        <span class="sr-only">Open main menu</span>
                        <span class="text-xl">‚ò∞</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="md:hidden hidden bg-slate-800" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3" id="mobile-nav-container"></div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto bg-slate-50 relative scroll-smooth" id="main-content">
        <!-- Content injected by JS -->
    </main>

    <!-- Footer Status Bar -->
    <footer class="bg-white border-t border-slate-200 py-2 px-6 text-xs text-slate-500 flex justify-between items-center shrink-0">
        <div>
            Context: <span id="footer-context" class="font-bold text-indigo-600">Loading...</span>
        </div>
        <div class="flex gap-4">
            <span>Session: 2PM - 5PM</span>
            <span class="text-emerald-600 font-semibold">‚óè System Active</span>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA & STATE ---
        const state = {
            currentTab: 'intro',
            simulator: {
                fileStatus: 'untracked',
                commits: 0
            },
            branching: {
                activeBranch: 'main', // 'main' or 'feature'
                mainCommits: [{x: 1, y: 0, tooltip: 'Init'}],
                featureCommits: [],
                connectors: [], // Stores lines {x:1, y:0}, {x:2, y:1}
                lastMainX: 1,
                lastFeatureX: null,
                globalX: 1
            }
        };

        const contentData = {
            intro: {
                title: "1. The 'Why' & Foundations",
                desc: "Understanding the problem Git solves: Chaos Management.",
                content: `
                    <div class="max-w-6xl mx-auto p-6 space-y-8 slide-enter">
                        
                        <!-- The "Why" Section -->
                        <div class="grid md:grid-cols-2 gap-8 items-center">
                            <div class="space-y-4">
                                <h2 class="text-3xl font-bold text-slate-800">Why do we need this?</h2>
                                <p class="text-lg text-slate-600">
                                    Imagine writing a group essay. Without Git, you're emailing Word docs back and forth. You overwrite each other's work. You lose paragraphs. It's a disaster.
                                </p>
                                <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg">
                                    <h3 class="font-bold text-red-800 text-sm uppercase mb-1">The Old Way (The Nightmare)</h3>
                                    <ul class="text-sm text-red-700 font-mono space-y-1">
                                        <li>project_final.folder</li>
                                        <li>project_final_v2.folder</li>
                                        <li>project_final_REAL_DO_NOT_TOUCH.folder</li>
                                    </ul>
                                </div>
                                <div class="bg-emerald-50 border-l-4 border-emerald-400 p-4 rounded-r-lg">
                                    <h3 class="font-bold text-emerald-800 text-sm uppercase mb-1">The Git Way</h3>
                                    <p class="text-sm text-emerald-700">
                                        One folder. A database of every change ever made. You can travel back in time to any version instantly.
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Key Concepts Cards -->
                            <div class="grid gap-4">
                                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:border-indigo-300 transition">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="p-2 bg-blue-100 text-blue-600 rounded-lg text-xl">üõ°Ô∏è</div>
                                        <h3 class="font-bold text-slate-800">Safety Net</h3>
                                    </div>
                                    <p class="text-sm text-slate-600">Deleted code by accident? Git has it saved. Broke the app? Revert to yesterday's version.</p>
                                </div>
                                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:border-indigo-300 transition">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="p-2 bg-purple-100 text-purple-600 rounded-lg text-xl">ü§ù</div>
                                        <h3 class="font-bold text-slate-800">Collaboration</h3>
                                    </div>
                                    <p class="text-sm text-slate-600">Multiple people can work on the <em>same file</em> at the same time. Git merges the work together.</p>
                                </div>
                                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:border-indigo-300 transition">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="p-2 bg-orange-100 text-orange-600 rounded-lg text-xl">üß™</div>
                                        <h3 class="font-bold text-slate-800">Experimentation</h3>
                                    </div>
                                    <p class="text-sm text-slate-600">Use <strong>Branches</strong> to test crazy ideas. If they fail, delete the branch. The main project stays safe.</p>
                                </div>
                            </div>
                        </div>

                        <hr class="border-slate-200">

                        <!-- Git vs GitHub -->
                        <div class="text-center py-4">
                            <h2 class="text-2xl font-bold text-slate-800 mb-6">Git vs. GitHub</h2>
                            <div class="flex flex-col md:flex-row justify-center gap-8">
                                <div class="flex-1 bg-slate-800 text-white p-6 rounded-2xl shadow-xl transform transition hover:-translate-y-1">
                                    <h3 class="text-xl font-bold mb-2">Git</h3>
                                    <p class="text-slate-400 text-sm mb-4">The Engine (Local)</p>
                                    <div class="text-left text-sm space-y-2 bg-slate-900 p-4 rounded-lg font-mono">
                                        <p>$ git commit</p>
                                        <p>$ git checkout</p>
                                        <p>$ git merge</p>
                                    </div>
                                    <p class="mt-4 text-xs text-slate-400">Works offline. Installed on your laptop.</p>
                                </div>
                                <div class="flex items-center text-slate-300 font-bold text-xl">VS</div>
                                <div class="flex-1 bg-white text-slate-800 border border-slate-200 p-6 rounded-2xl shadow-xl transform transition hover:-translate-y-1">
                                    <h3 class="text-xl font-bold mb-2">GitHub</h3>
                                    <p class="text-slate-500 text-sm mb-4">The Cloud (Remote)</p>
                                    <div class="text-left text-sm space-y-2 bg-slate-50 p-4 rounded-lg border border-slate-100">
                                        <p>‚òÅÔ∏è Backups</p>
                                        <p>üëÄ Code Review (PRs)</p>
                                        <p>üêû Issue Tracking</p>
                                    </div>
                                    <p class="mt-4 text-xs text-slate-400">Website. Needs Internet. Google Drive for Code.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            workflow: {
                title: "2. The 3 Stages (The Core)",
                desc: "This is where 90% of beginners get stuck. You must understand the difference between 'Staging' and 'Committing'.",
                content: `
                    <div class="max-w-6xl mx-auto p-6 space-y-8 slide-enter">
                        <!-- Simulator Interface -->
                        <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                            <div class="bg-slate-800 p-4 flex justify-between items-center text-white">
                                <div>
                                    <h3 class="font-bold text-lg">Interactive Simulator</h3>
                                    <p class="text-xs text-slate-400">Follow the file's journey from creation to history.</p>
                                </div>
                                <button onclick="resetSim()" class="text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded transition border border-slate-600">Reset Demo</button>
                            </div>
                            
                            <!-- Control Panel -->
                            <div class="p-4 bg-slate-100 border-b border-slate-200 flex flex-wrap gap-4 justify-center">
                                <button onclick="simAction('create')" class="bg-white border border-slate-300 shadow-sm px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 active:scale-95 transition flex items-center gap-2">
                                    <span class="text-emerald-500 text-lg">‚úö</span> 1. Create File
                                </button>
                                <button onclick="simAction('add')" class="bg-indigo-600 text-white shadow-md px-4 py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700 active:scale-95 transition cmd-font flex items-center gap-2">
                                    <span>2. git add</span>
                                </button>
                                <button onclick="simAction('commit')" class="bg-slate-800 text-white shadow-md px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-900 active:scale-95 transition cmd-font flex items-center gap-2">
                                    <span>3. git commit</span>
                                </button>
                                <div class="w-px h-10 bg-slate-300 mx-2"></div>
                                <button onclick="simAction('modify')" class="bg-white border border-slate-300 shadow-sm px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 active:scale-95 transition flex items-center gap-2">
                                    <span class="text-amber-500 text-lg">‚úé</span> Edit File
                                </button>
                            </div>

                            <!-- Visualization Area -->
                            <div class="p-8 bg-slate-50 min-h-[400px] relative">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 h-full">
                                    
                                    <!-- Zone 1: Working Directory -->
                                    <div class="stage-box border-2 border-dashed border-slate-300 rounded-xl p-4 bg-white relative min-h-[250px] flex flex-col items-center justify-start pt-8" id="zone-working">
                                        <div class="text-slate-500 font-bold uppercase tracking-wider text-xs mb-1">Working Directory</div>
                                        <div class="text-center text-slate-400 text-[10px] mb-4">You are here when typing code.<br>Files are "Untracked" or "Modified".</div>
                                    </div>

                                    <!-- Zone 2: Staging Area -->
                                    <div class="stage-box border-2 border-dashed border-indigo-300 rounded-xl p-4 bg-indigo-50/50 relative min-h-[250px] flex flex-col items-center justify-start pt-8" id="zone-staging">
                                        <div class="text-indigo-500 font-bold uppercase tracking-wider text-xs mb-1">Staging Area (Index)</div>
                                        <div class="text-center text-indigo-400 text-[10px] mb-4">The "Shopping Cart".<br>You choose what to include in the next save.</div>
                                    </div>

                                    <!-- Zone 3: Repository -->
                                    <div class="stage-box border-2 border-slate-300 rounded-xl p-4 bg-slate-100 relative min-h-[250px] flex flex-col items-center justify-start pt-8" id="zone-repo">
                                        <div class="text-slate-600 font-bold uppercase tracking-wider text-xs mb-1">Local Repository</div>
                                        <div class="text-center text-slate-400 text-[10px] mb-4">Permanent History.<br>Snapshots live here.</div>
                                        
                                        <!-- Commit Stack -->
                                        <div id="commit-stack" class="w-full mt-auto flex flex-col-reverse gap-1 px-4 pb-2">
                                            <!-- Commits appear here -->
                                        </div>
                                    </div>

                                </div>

                                <!-- The File Token (Animated) -->
                                <div id="file-token" class="hidden absolute w-32 h-16 bg-white shadow-lg border border-slate-200 rounded-lg flex items-center justify-center gap-2 z-10 transition-all duration-700 ease-in-out">
                                    <span class="text-2xl">üìÑ</span>
                                    <div class="flex flex-col">
                                        <span class="text-xs font-bold text-slate-700">script.js</span>
                                        <span class="text-[10px] uppercase font-bold" id="file-status-text">Untracked</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status Log -->
                            <div class="bg-black text-green-400 font-mono text-xs p-4 h-32 overflow-y-auto" id="console-log">
                                <div class="opacity-50">> System ready. Waiting for user input...</div>
                            </div>
                        </div>
                    </div>
                `
            },
            branching: {
                title: "3. Branching & Merging (Fixed)",
                desc: "Branching creates a safe sandbox. Merging brings your work back to the main project.",
                content: `
                    <div class="max-w-6xl mx-auto p-6 space-y-8 slide-enter">
                         <div class="grid md:grid-cols-3 gap-6">
                             <div class="md:col-span-2 space-y-4">
                                 <div class="flex justify-between items-end">
                                     <h2 class="text-2xl font-bold text-slate-800">Visualizing the Tree</h2>
                                     <div id="active-branch-badge" class="px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-sm font-bold border border-blue-200 flex items-center gap-2">
                                        <span class="w-2 h-2 rounded-full bg-blue-600"></span> Current: Main Branch
                                     </div>
                                 </div>
                                 
                                 <!-- Interactive Chart Container -->
                                 <div class="bg-white p-4 rounded-xl shadow border border-slate-200">
                                     <div class="chart-container h-80">
                                         <canvas id="branchChart"></canvas>
                                     </div>
                                 </div>
                                 <p class="text-sm text-slate-500 text-center italic">
                                    Blue dots = Main Branch | Purple dots = Feature Branch | Grey lines = History flow
                                 </p>
                             </div>

                             <!-- Controls -->
                             <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 h-fit flex flex-col gap-4">
                                 <h3 class="font-bold text-slate-800 border-b border-slate-200 pb-2">Actions</h3>
                                 
                                 <!-- Commit Button -->
                                 <div class="space-y-1">
                                    <button onclick="branchAction('commit')" class="w-full text-left px-4 py-3 bg-white border border-slate-200 shadow-sm rounded-lg hover:bg-slate-50 transition flex items-center gap-3 group">
                                        <div class="bg-indigo-100 text-indigo-600 p-2 rounded text-xs font-mono group-hover:bg-indigo-200">git commit</div>
                                        <div class="text-sm text-slate-600">Save Snapshot</div>
                                    </button>
                                    <p class="text-[10px] text-slate-400 pl-1">Adds a dot to your current line.</p>
                                 </div>

                                 <!-- Checkout Button -->
                                 <div class="space-y-1">
                                    <button onclick="branchAction('checkout')" class="w-full text-left px-4 py-3 bg-white border border-slate-200 shadow-sm rounded-lg hover:bg-slate-50 transition flex items-center gap-3 group">
                                        <div class="bg-purple-100 text-purple-600 p-2 rounded text-xs font-mono group-hover:bg-purple-200">git checkout -b</div>
                                        <div class="text-sm text-slate-600">New Branch</div>
                                    </button>
                                    <p class="text-[10px] text-slate-400 pl-1">Splits from Main -> Feature. Switches active line.</p>
                                 </div>

                                 <!-- Merge Button -->
                                 <div class="space-y-1">
                                    <button onclick="branchAction('merge')" class="w-full text-left px-4 py-3 bg-white border border-slate-200 shadow-sm rounded-lg hover:bg-slate-50 transition flex items-center gap-3 group">
                                        <div class="bg-emerald-100 text-emerald-600 p-2 rounded text-xs font-mono group-hover:bg-emerald-200">git merge</div>
                                        <div class="text-sm text-slate-600">Merge & Finish</div>
                                    </button>
                                    <p class="text-[10px] text-slate-400 pl-1">Joins Feature back to Main. Switches back to Main.</p>
                                 </div>
                                 
                                 <button onclick="resetBranchChart()" class="mt-4 w-full text-center py-2 text-xs text-red-400 hover:text-red-600 border border-transparent hover:border-red-200 rounded">
                                     Reset Graph
                                 </button>
                             </div>
                         </div>
                    </div>
                `
            },
            remote: {
                title: "4. Remote Collaboration",
                desc: "Working with GitHub. Remotes, Pushes, Pulls, and the Pull Request workflow.",
                content: `
                    <div class="max-w-6xl mx-auto p-6 space-y-8 slide-enter">
                        <!-- Workflow Diagram -->
                        <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200">
                            <h2 class="text-center font-bold text-2xl text-slate-800 mb-8">The GitHub Cycle</h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                <!-- Step 1 -->
                                <div class="flex flex-col items-center text-center space-y-2 p-4 bg-slate-50 rounded-lg">
                                    <div class="text-4xl">üíª</div>
                                    <h3 class="font-bold text-slate-700">1. Local</h3>
                                    <p class="text-xs text-slate-500">You commit changes on your laptop.</p>
                                </div>
                                
                                <!-- Arrow -->
                                <div class="flex flex-col items-center justify-center">
                                    <span class="text-xs font-mono bg-indigo-100 px-2 py-1 rounded text-indigo-700 mb-1 font-bold">git push</span>
                                    <div class="text-slate-300 text-2xl">‚ûî</div>
                                </div>

                                <!-- Step 2 -->
                                <div class="flex flex-col items-center text-center space-y-2 p-4 bg-purple-50 rounded-lg border border-purple-100">
                                    <div class="text-4xl">‚òÅÔ∏è</div>
                                    <h3 class="font-bold text-purple-900">2. Remote</h3>
                                    <p class="text-xs text-purple-700">Code is on GitHub.com.</p>
                                </div>

                                <!-- Arrow -->
                                <div class="flex flex-col items-center justify-center">
                                    <span class="text-xs font-mono bg-emerald-100 px-2 py-1 rounded text-emerald-700 mb-1 font-bold">Pull Request</span>
                                    <div class="text-slate-300 text-2xl">‚ûî</div>
                                </div>

                                <!-- Step 3 -->
                                <div class="flex flex-col items-center text-center space-y-2 p-4 bg-emerald-50 rounded-lg border border-emerald-100">
                                    <div class="text-4xl">‚úÖ</div>
                                    <h3 class="font-bold text-emerald-900">3. Main Branch</h3>
                                    <p class="text-xs text-emerald-700">Merged & Deployed.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Concepts -->
                        <div class="grid md:grid-cols-2 gap-6 mt-8">
                            <div class="bg-white p-6 rounded-lg border-l-4 border-indigo-500 shadow-sm">
                                <h3 class="font-bold text-lg text-slate-800 mb-2">What is a Pull Request (PR)?</h3>
                                <p class="text-slate-600 mb-2">It's NOT just merging. It's a conversation.</p>
                                <p class="text-sm text-slate-500">"Hey team, I fixed the login bug. Here is my code. Please review it before we add it to the main project."</p>
                            </div>
                            <div class="bg-white p-6 rounded-lg border-l-4 border-orange-500 shadow-sm">
                                <h3 class="font-bold text-lg text-slate-800 mb-2">What is 'git pull'?</h3>
                                <p class="text-slate-600 mb-2">The opposite of push.</p>
                                <p class="text-sm text-slate-500">"Hey GitHub, did my teammates add anything new while I was sleeping? Download it to my laptop."</p>
                            </div>
                        </div>
                    </div>
                `
            },
            cheatsheet: {
                title: "5. Command Reference",
                desc: "Don't memorize everything. Memorize these.",
                content: `
                    <div class="max-w-6xl mx-auto p-6 space-y-8 slide-enter">
                        <div class="bg-white rounded-xl shadow overflow-hidden border border-slate-200">
                            <table class="min-w-full divide-y divide-slate-200">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase">Command</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase">What it does</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase">When to use</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-slate-200 text-sm">
                                    <tr><td class="px-6 py-4 font-mono text-indigo-600 font-bold">git status</td><td class="px-6 py-4">Shows changed files</td><td class="px-6 py-4 text-emerald-600 font-bold">All the time</td></tr>
                                    <tr><td class="px-6 py-4 font-mono text-indigo-600 font-bold">git add .</td><td class="px-6 py-4">Stages ALL changes</td><td class="px-6 py-4">When you're happy with edits</td></tr>
                                    <tr><td class="px-6 py-4 font-mono text-indigo-600 font-bold">git commit -m "msg"</td><td class="px-6 py-4">Saves a version</td><td class="px-6 py-4">After staging</td></tr>
                                    <tr><td class="px-6 py-4 font-mono text-indigo-600 font-bold">git push</td><td class="px-6 py-4">Uploads to GitHub</td><td class="px-6 py-4">End of day / Feature done</td></tr>
                                    <tr><td class="px-6 py-4 font-mono text-indigo-600 font-bold">git pull</td><td class="px-6 py-4">Downloads changes</td><td class="px-6 py-4">Start of day</td></tr>
                                    <tr class="bg-red-50"><td class="px-6 py-4 font-mono text-red-600 font-bold">git checkout .</td><td class="px-6 py-4">Undoes LOCAL changes</td><td class="px-6 py-4 text-red-600">Emergency (Danger!)</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `
            }
        };

        const navItems = [
            { id: 'intro', label: '1. Intro & Why' },
            { id: 'workflow', label: '2. The Workflow' },
            { id: 'branching', label: '3. Branching' },
            { id: 'remote', label: '4. Remote' },
            { id: 'cheatsheet', label: '5. Commands' }
        ];

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderNav();
            loadTab('intro');
        });

        // --- NAVIGATION ---
        function renderNav() {
            const container = document.getElementById('nav-container');
            const mobileContainer = document.getElementById('mobile-nav-container');
            
            navItems.forEach(item => {
                const btn = document.createElement('a');
                btn.href = "#";
                btn.className = `px-3 py-2 rounded-md text-sm font-medium transition ${state.currentTab === item.id ? 'bg-slate-700 text-white' : 'text-slate-300 hover:bg-slate-700 hover:text-white'}`;
                btn.textContent = item.label;
                btn.onclick = (e) => { e.preventDefault(); loadTab(item.id); };
                btn.id = `nav-${item.id}`;
                container.appendChild(btn);

                const mobBtn = document.createElement('a');
                mobBtn.href = "#";
                mobBtn.className = "block px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:text-white hover:bg-slate-700";
                mobBtn.textContent = item.label;
                mobBtn.onclick = (e) => { e.preventDefault(); loadTab(item.id); document.getElementById('mobile-menu').classList.add('hidden'); };
                mobileContainer.appendChild(mobBtn);
            });

            document.getElementById('mobile-menu-btn').onclick = () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            };
        }

        function loadTab(id) {
            state.currentTab = id;
            
            navItems.forEach(item => {
                const el = document.getElementById(`nav-${item.id}`);
                if(el) {
                    if (item.id === id) {
                        el.classList.add('bg-slate-700', 'text-white');
                        el.classList.remove('text-slate-300');
                    } else {
                        el.classList.remove('bg-slate-700', 'text-white');
                        el.classList.add('text-slate-300');
                    }
                }
            });

            const main = document.getElementById('main-content');
            const data = contentData[id];
            
            main.innerHTML = `
                <header class="bg-white shadow-sm border-b border-slate-200 py-6 px-4 sm:px-6 lg:px-8">
                    <div class="max-w-6xl mx-auto">
                        <h1 class="text-3xl font-bold text-slate-900">${data.title}</h1>
                        <p class="mt-2 text-slate-600 text-lg">${data.desc}</p>
                    </div>
                </header>
                ${data.content}
            `;

            document.getElementById('footer-context').textContent = data.title;

            // Delayed Init for Canvas elements
            setTimeout(() => {
                if (id === 'workflow') initWorkflowSim();
                if (id === 'branching') initBranchChart();
            }, 50);
        }

        // --- WORKFLOW SIMULATOR LOGIC ---
        function initWorkflowSim() {
            state.simulator.fileStatus = 'untracked';
            updateConsole('Simulation initialized. Ready.');
        }

        function simAction(action) {
            const token = document.getElementById('file-token');
            const statusText = document.getElementById('file-status-text');
            const zoneWorking = document.getElementById('zone-working');
            const zoneStaging = document.getElementById('zone-staging');
            const zoneRepo = document.getElementById('zone-repo');

            if (action === 'create') {
                if (state.simulator.fileStatus !== 'untracked' && state.simulator.fileStatus !== 'deleted') {
                    updateConsole('Error: File already exists.', 'red');
                    return;
                }
                state.simulator.fileStatus = 'untracked';
                token.classList.remove('hidden');
                token.classList.remove('bg-indigo-100', 'bg-emerald-100', 'bg-amber-100');
                token.classList.add('bg-white');
                statusText.innerText = 'Untracked';
                statusText.className = 'text-[10px] uppercase font-bold text-red-500';
                moveTokenTo(zoneWorking);
                updateConsole('File "script.js" created.', 'white');
            }
            else if (action === 'add') {
                if (state.simulator.fileStatus === 'untracked' || state.simulator.fileStatus === 'modified') {
                    state.simulator.fileStatus = 'staged';
                    statusText.innerText = 'Staged';
                    statusText.className = 'text-[10px] uppercase font-bold text-indigo-600';
                    token.classList.remove('bg-white', 'bg-amber-100');
                    token.classList.add('bg-indigo-100');
                    moveTokenTo(zoneStaging);
                    updateConsole('$ git add script.js', 'green');
                } else {
                    updateConsole('Nothing to add (file is committed or not created).', 'yellow');
                }
            }
            else if (action === 'commit') {
                if (state.simulator.fileStatus === 'staged') {
                    state.simulator.fileStatus = 'committed';
                    state.simulator.commits++;
                    statusText.innerText = 'Committed';
                    statusText.className = 'text-[10px] uppercase font-bold text-emerald-600';
                    token.classList.remove('bg-indigo-100');
                    token.classList.add('bg-emerald-100');
                    moveTokenTo(zoneRepo);
                    updateConsole(`$ git commit -m "Save #${state.simulator.commits}"`, 'green');
                    
                    const stack = document.getElementById('commit-stack');
                    const block = document.createElement('div');
                    block.className = 'w-full h-8 bg-slate-300 rounded border border-slate-400 text-[10px] flex items-center justify-center text-slate-600 slide-enter';
                    block.innerText = `Commit #${state.simulator.commits}`;
                    stack.appendChild(block);
                } else {
                    updateConsole('Nothing to commit. Stage changes first!', 'red');
                }
            }
            else if (action === 'modify') {
                if (state.simulator.fileStatus === 'committed') {
                    state.simulator.fileStatus = 'modified';
                    statusText.innerText = 'Modified';
                    statusText.className = 'text-[10px] uppercase font-bold text-amber-600';
                    token.classList.remove('bg-emerald-100');
                    token.classList.add('bg-amber-100');
                    moveTokenTo(zoneWorking);
                    updateConsole('File modified. Changes in Working Dir.', 'yellow');
                } else {
                    updateConsole('Can only modify committed files in this demo.', 'yellow');
                }
            }
        }

        function moveTokenTo(element) {
            const token = document.getElementById('file-token');
            const top = element.offsetTop + 60;
            const left = element.offsetLeft + (element.offsetWidth / 2) - (token.offsetWidth / 2);
            token.style.top = `${top}px`;
            token.style.left = `${left}px`;
        }
        
        function resetSim() {
            state.simulator.fileStatus = 'untracked';
            state.simulator.commits = 0;
            document.getElementById('file-token').classList.add('hidden');
            document.getElementById('commit-stack').innerHTML = '';
            document.getElementById('console-log').innerHTML = '<div class="opacity-50">> System ready. Waiting for user input...</div>';
        }

        function updateConsole(text, color = 'gray') {
            const consoleEl = document.getElementById('console-log');
            const line = document.createElement('div');
            if (color === 'red') line.className = 'text-red-400';
            else if (color === 'green') line.className = 'text-emerald-400';
            else if (color === 'yellow') line.className = 'text-amber-400';
            else if (color === 'white') line.className = 'text-white';
            else line.className = 'text-slate-400';
            line.innerText = text;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        // --- BRANCHING CHART LOGIC (REBUILT) ---
        let branchChartInst = null;
        
        function initBranchChart() {
            const ctx = document.getElementById('branchChart');
            if (!ctx) return;
            
            // FIX: Destroy existing instance before creating a new one
            if (branchChartInst) {
                branchChartInst.destroy();
                branchChartInst = null;
            }
            
            // Reset state on init
            state.branching.activeBranch = 'main';
            state.branching.mainCommits = [{x: 1, y: 0, tooltip: 'Init'}];
            state.branching.featureCommits = [];
            state.branching.connectors = [];
            state.branching.globalX = 1;
            state.branching.lastMainX = 1;
            state.branching.lastFeatureX = null;

            updateBadge();
            
            branchChartInst = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Main Branch',
                            data: state.branching.mainCommits,
                            backgroundColor: '#2563eb', // Blue
                            borderColor: '#2563eb',
                            showLine: true,
                            pointRadius: 8
                        },
                        {
                            label: 'Feature Branch',
                            data: state.branching.featureCommits,
                            backgroundColor: '#9333ea', // Purple
                            borderColor: '#9333ea',
                            showLine: true,
                            pointRadius: 8
                        },
                        {
                            label: 'Flow',
                            data: state.branching.connectors, // Lines connecting branches
                            borderColor: '#94a3b8', // Slate 400
                            borderDash: [5, 5],
                            showLine: true,
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 500 },
                    scales: {
                        x: { 
                            type: 'linear', 
                            min: 0, 
                            max: 10, // Dynamic
                            ticks: { stepSize: 1 },
                            title: { display: true, text: 'Time ->' }
                        },
                        y: { 
                            min: -0.5, 
                            max: 1.5, 
                            ticks: { 
                                callback: val => val === 0 ? 'Main' : (val === 1 ? 'Feature' : '') 
                            },
                            grid: { display: true }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => ctx.raw.tooltip || 'Commit'
                            }
                        }
                    }
                }
            });
        }

        function updateBadge() {
            const badge = document.getElementById('active-branch-badge');
            if(!badge) return;
            if(state.branching.activeBranch === 'main') {
                badge.className = "px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-sm font-bold border border-blue-200 flex items-center gap-2";
                badge.innerHTML = `<span class="w-2 h-2 rounded-full bg-blue-600"></span> Current: Main Branch`;
            } else {
                badge.className = "px-3 py-1 rounded-full bg-purple-100 text-purple-700 text-sm font-bold border border-purple-200 flex items-center gap-2";
                badge.innerHTML = `<span class="w-2 h-2 rounded-full bg-purple-600"></span> Current: Feature Branch`;
            }
        }

        function branchAction(type) {
            if (!branchChartInst) return;

            // 1. COMMIT
            if (type === 'commit') {
                state.branching.globalX++;
                const newX = state.branching.globalX;
                
                if (state.branching.activeBranch === 'main') {
                    state.branching.mainCommits.push({x: newX, y: 0, tooltip: 'Commit (Main)'});
                    state.branching.lastMainX = newX;
                } else {
                    state.branching.featureCommits.push({x: newX, y: 1, tooltip: 'Commit (Feature)'});
                    state.branching.lastFeatureX = newX;
                }
            } 
            
            // 2. CHECKOUT (Split)
            else if (type === 'checkout') {
                if(state.branching.activeBranch === 'feature') return alert("You are already on the Feature branch!");
                
                // Switch context
                state.branching.activeBranch = 'feature';
                updateBadge();
                
                // Draw connector line from last Main point to where Feature starts
                // But we don't add a point yet, just a visual connector for the FUTURE point? 
                // Actually, to make it visual, let's add the first feature point immediately as a "Branch Start"
                state.branching.globalX++;
                const newX = state.branching.globalX;
                
                state.branching.featureCommits.push({x: newX, y: 1, tooltip: 'Branch Created'});
                state.branching.lastFeatureX = newX;
                
                // Add connector line
                state.branching.connectors.push(
                    {x: state.branching.lastMainX, y: 0}, 
                    {x: newX, y: 1}, 
                    {x: null, y: null} // Break line
                );
            }
            
            // 3. MERGE
            else if (type === 'merge') {
                if(state.branching.activeBranch === 'main') return alert("You must be on Feature to merge into Main (simplified flow) or check out Main first.");
                if(state.branching.featureCommits.length === 0) return alert("Make a commit on feature first!");

                // Switch back
                state.branching.activeBranch = 'main';
                updateBadge();
                
                state.branching.globalX++;
                const newX = state.branching.globalX;
                
                // Add Merge Commit on Main
                state.branching.mainCommits.push({x: newX, y: 0, tooltip: 'Merge Commit'});
                
                // Connector from Feature to Main
                state.branching.connectors.push(
                    {x: state.branching.lastFeatureX, y: 1},
                    {x: newX, y: 0},
                    {x: null, y: null}
                );
                
                state.branching.lastMainX = newX;
            }

            // Update Chart Scale
            branchChartInst.options.scales.x.max = state.branching.globalX + 2;
            branchChartInst.update();
        }

        function resetBranchChart() {
            initBranchChart();
        }
    </script>
</body>
</html>